!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports,require("google/incremental-dom")):"function"==typeof define&&define.amd?define(["exports","google/incremental-dom"],b):b(a.DNA=a.DNA||{},a.IncrementalDOM)}(this,function(a,b){"use strict";function c(a){return"function"==typeof a}function d(a){return"string"==typeof a}function e(a){return"object"==typeof a}function f(a){return"undefined"==typeof a}function g(a){return Array.isArray(a)}function h(a){try{return!d(a.outerHTML)}catch(a){return!0}}function i(a){var b=self[a],c=function(){if(this.constructor){if(!h(this))return this;var a=E.get(this.is),b=document.createElement(a.config.extends?a.config.extends:this.is);return a.config.extends&&b.setAttribute("is",this.is),b.__proto__=a.Ctr.prototype,b}return null};return self[a]=c,self[a].prototype=Object.create(b.prototype,{constructor:{value:self[a],configurable:!0,writable:!0}}),self[a]}function j(a){return a.replace(/\W+/g,"-").replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()}function k(a){return a.replace(/\W+(.)/g,function(a,b){return b.toUpperCase()})}function l(a,b,c){var d=a.getAttribute(b);if(d!==c)if(null!==c&&void 0!==c&&c!==!1){var e=typeof c;"string"===e||"number"===e?a.setAttribute(b,c):"boolean"===e&&a.setAttribute(b,"")}else(d||""===d)&&a.removeAttribute(b)}function m(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return new(Function.prototype.bind.apply(K,[null].concat(b)))}function n(a,b){if(""===b&&a.accepts(Boolean))return!0;if(!a.accepts(String))try{return JSON.parse(b)}catch(a){}return b}function o(a,b,c,d){a.addEventListener(b,function(b){for(var e=b.target;e&&e!==a;){if(e.matches(c)&&d.call(a,b,e)===!1)return;e=e.parentNode}})}function p(a){var b=document.createElement("style");return b.type="text/css",b.setAttribute("id",a),b}function q(a,b){var d=document.getElementById(a);if(!d){var e="";if(Array.isArray(b)||(b=[b]),b.forEach(function(a){c(a)&&(a=a()),e+=a}),a="style-"+a,d=p(a),d.innerHTML="",d.textContent=e,!d.parentNode){var f=document.head;f.firstElementChild?f.insertBefore(d,f.firstElementChild):f.appendChild(d)}}return d}function r(a,b){if(a)for(var c in a){var d=b(c,a[c]);if(d)return d}return!1}function s(a){var b=[];return r(a,function(a,c){c===!0&&(c=""),b.push(a,c)}),b}function t(a){if(Array.isArray(a))a=a.join("");else if("object"==typeof a)try{a=JSON.stringify(a)}catch(b){a=a.toString()}return a}function u(a){if(a.nodeType===Node.ELEMENT_NODE){var b=a.getAttribute("is")||a.tagName;if(!ha||!ga.get(b)){var c=E.get(b);if(c)return c}}return null}function v(a,b){b=b||u(a),b&&(a.__proto__=b.Ctr.prototype,Object.defineProperty(a,"constructor",{value:b.Ctr,configurable:!0,writable:!0}),b.Ctr.prototype.constructor.call(a),a.connectedCallback())}function w(a,b){var c=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];return Object.defineProperty(b.prototype,"is",{configurable:!1,get:function(){return a}}),E.define(a,b,c),f(self.customElements)||self.customElements.define(a,b,c),b}var x=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},y=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),z=function(a){return new A(a)},A=function(){function a(b){x(this,a),this.superclass=b}return y(a,[{key:"with",value:function(){return Array.from(arguments).reduce(function(a,b){return b(a)},this.superclass)}}]),a}(),B=function(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b},C=function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)},D=function(){function a(){x(this,a),this.components={}}return y(a,[{key:"define",value:function(a,b,c){this.components[a.toLowerCase()]={Ctr:b,config:c}}},{key:"get",value:function(a){return this.components[a.toLowerCase()]}}]),a}(),E=new D,F=i("HTMLElement"),G=function(a){function b(){return x(this,b),B(this,Object.getPrototypeOf(b).apply(this,arguments))}return C(b,a),y(b,[{key:"connectedCallback",value:function(){}},{key:"disconnectedCallback",value:function(){}},{key:"attributeChangedCallback",value:function(){}}]),b}(F),H=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},I=Object.defineProperty,J=function(){function a(){x(this,a),this.callbacks=[]}return y(a,[{key:"observe",value:function(a){return c(a)&&this.callbacks.push(a),this}},{key:"unobserve",value:function(a){var b=this.callbacks.indexOf(a);b!==-1&&this.callbacks.splice(b,1)}},{key:"changed",value:function(){for(var a=[],b=0,c=this.callbacks.length;b<c;b++){var d,e=(d=this.callbacks)[b].apply(d,arguments);if(e===!1)return a;a.push(e)}return a}}]),a}(),K=function(a){function b(){var a=arguments.length<=0||void 0===arguments[0]?[]:arguments[0];x(this,b);var c=B(this,Object.getPrototypeOf(b).call(this));return g(a)||(a=[a]),c.ctrs=a,c.required=!1,c.validator=function(){return!0},c.beforeSet=function(a){return a},c.getter=function(){return c.value},c.setter=function(a){if(a=c.beforeSet(a),c.validateType(a)&&c.validator(a)){if(c.value!==a){var b=c.value;c.value=a,c.changed(a,b)}return!0}return!1},c}return C(b,a),y(b,[{key:"accepts",value:function(a){return this.ctrs.indexOf(a)!==-1}},{key:"default",value:function(a){return this.value=a,this}},{key:"scoped",value:function(a){return this.scope=a,I(a,this.name,{get:this.getter.bind(this),set:this.setter.bind(this),configurable:!0}),this}},{key:"require",value:function(){return this.required=!0,this}},{key:"before",value:function(a){return c(a)&&(this.beforeSet=a),this}},{key:"validate",value:function(a){return c(a)&&(this.validator=a),this}},{key:"validateType",value:function(a){var b=0,c=this.ctrs;if(0===c.length)return!0;for(;b<c.length;){if(a instanceof c[b]||a.constructor&&a.constructor===c[b])return!0;b++}throw new TypeError('Invalid "'+a+'" value for "'+this.name+'" property for '+this.scope.is+" components.")}},{key:"init",value:function(a){if(!f(a)&&!this.setter(a)&&this.required)throw new Error('"'+this.name+'" property is required for '+this.scope.is+" components.")}}]),b}(J),L=function(a){function b(a){x(this,b);var c=B(this,Object.getPrototypeOf(b).call(this));return c.props=[],c.add(a),c}return C(b,a),y(b,[{key:"add",value:function(a){var b=this;if(a instanceof K)this.props.push(a.observe(function(){return b.changed.apply(b,arguments)}));else if(e(a))for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];d instanceof K||(d=new K(d)),d.name=c,this.add(d)}}},{key:"has",value:function(a){return!!this.iterate(function(b){if(b.name===a)return!0})}},{key:"get",value:function(a){var b=this.iterate(function(b){if(b.name===a)return b});if(b)return b;throw new Error("Property not found.")}},{key:"iterate",value:function(a){for(var b=0,c=this.props.length;b<c;b++){var d=a(this.props[b]);if(!f(d))return d}return!1}}]),b}(J);I(m,"ANY",{get:function(){return m()}}),I(m,"STRING",{get:function(){return m(String)}}),I(m,"BOOLEAN",{get:function(){return m(Boolean)}}),I(m,"NUMBER",{get:function(){return m(Number)}});var M=function(a){return function(a){function b(){x(this,b);var a=B(this,Object.getPrototypeOf(b).call(this)),c=a.properties||new L;c instanceof L||!function(){var a=new L;g(c)||(c=[c]),c.forEach(function(b){a.add(b)}),c=a}(),Object.defineProperty(a,"properties",{value:c});for(var d=Array.prototype.slice.call(a.attributes||[],0),e={},f=0,h=d.length;f<h;f++){var i=d[f],m=k(i.name);c.has(m)&&(e[m]=n(c.get(m),i.value))}return c.iterate(function(b){var c=j(b.name);b.scoped(a),b.observe(function(b){l(a,c,b)}),b.init(e[b.name])}),a}return C(b,a),y(b,[{key:"attributeChangedCallback",value:function(a,c,d){H(Object.getPrototypeOf(b.prototype),"attributeChangedCallback",this).call(this,a,c,d);var e=k(a);this.properties.has(e)&&(this[e]=n(this.properties.get(e),d))}},{key:"observeProperty",value:function(a,b){var c=this.properties.get(a);c.observe(b)}},{key:"observeProperties",value:function(a){return this.properties.observe(a)}}]),b}(a)},N=function(a){function b(){return x(this,b),B(this,Object.getPrototypeOf(b).apply(this,arguments))}return C(b,a),b}(z(G).with(M)),O=function(a){return function(a){function b(){x(this,b);var a=B(this,Object.getPrototypeOf(b).call(this)),e=a.constructor.events||{};for(var f in e)e.hasOwnProperty(f)&&!function(){var b=d(e[f])?a[e[f]]:e[f];if(c(b)){var g=f.match(/([^\s]+)(.*)?/),h=g[1],i=(g[2]||"").trim();i?o(a,h,i,function(c,d){b.call(a,c,d)}):a.addEventListener(h,function(c){b.call(a,c,a)})}}();return a}return C(b,a),y(b,[{key:"trigger",value:function(a,b){var c=arguments.length<=2||void 0===arguments[2]||arguments[2],d=arguments.length<=3||void 0===arguments[3]||arguments[3];if(!a)throw new Error("Event name is undefined");var e=new CustomEvent(a,{detail:b,bubbles:c,cancelable:d});return this.dispatchEvent(e)}}]),b}(a)},P=function(a){function b(){return x(this,b),B(this,Object.getPrototypeOf(b).apply(this,arguments))}return C(b,a),b}(z(G).with(O)),Q=function(a){return function(a){function b(){x(this,b);var a=B(this,Object.getPrototypeOf(b).call(this));if(a.is){var c=a.constructor,d=c.css;d&&q(a.is,d),a.classList.add(a.is)}return a}return C(b,a),b}(a)},R=function(a){function b(){return x(this,b),B(this,Object.getPrototypeOf(b).apply(this,arguments))}return C(b,a),b}(z(G).with(Q)),S=function(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)},T=/^\s*/g,U=/\>\s+\</g,V=/([^<]*)/m,W=/(<\/?([a-zA-Z1-9\-]*)([^>]*)>?)/m,X=/([^><]*)>?/m,Y=/[\'\"\/\s]/,Z=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],$=/\/>$/,_=function(){function a(b){x(this,a),this.data=b,this.restart()}return y(a,null,[{key:"isSelfClosing",value:function(a){return Z.indexOf(a.toLowerCase())!==-1||!!a.match($)}},{key:"convertProps",value:function(){var a=arguments.length<=0||void 0===arguments[0]?"":arguments[0],b=!(arguments.length<=1||void 0===arguments[1])&&arguments[1];if(a){a=a.trim();for(var c=!1,d=!1,e=!1,f=!1,g=null,h={},i=0,j=a.length;i<j;i++){var k=a[i];"="===k?c&&(h[g]=!1,c=!1,f=!0):k.match(/[\s|\n]/)?d?(h[g]=h[g]||"",h[g]+=k):c?g&&(h[g]=!0,g=null,c=!1):f&&(e||("undefined"===h[g]?h[g]=void 0:"null"===h[g]&&(h[g]=null)),g=null,f=!1,e=!1):'"'!==k&&"'"!==k||!g?f?(h[g]=h[g]||"",h[g]+=k):(c=!0,g=g||"",""===g&&k.match(Y)||(g+=k)):f&&h[g]!==!1?(g=null,c=!1,d=!1):(d=!0,e=!0,h[g]=h[g]||"")}return c&&g?h[g]=b:f&&!e?"undefined"===h[g]?h[g]=void 0:"null"===h[g]&&(h[g]=null):d&&(h[g]=!1),h}return{}}},{key:"OPEN_ELEMENT",get:function(){return"OPEN_ELEMENT"}},{key:"OPEN_ELEMENT_END",get:function(){return"OPEN_ELEMENT_END"}},{key:"CLOSE_ELEMENT",get:function(){return"CLOSE_ELEMENT"}},{key:"CONTENT",get:function(){return"CONTENT"}}]),y(a,[{key:"restart",value:function(){this.setCurrent(this.data)}},{key:"setCurrent",value:function(a){"string"==typeof a&&(this.current=a.replace(T,"").replace(U,"><"))}},{key:"ended",value:function(){return!this.current}},{key:"next",value:function(){var b=!1;if(!this.ended()){var c=void 0,d=this.current;if("<"!==d[0])">"===d[0]?(c=[d,">"],b={chunk:d,type:a.OPEN_ELEMENT_END}):(c=d.match(X),c||(c=d.match(V)),b={chunk:d,type:a.CONTENT,content:c[1]});else if(c=d.match(W),"/"===d[1])b={chunk:d,type:a.CLOSE_ELEMENT,tag:c[2]};else{var e=c[1];b=">"===e[e.length-1]?{chunk:d,type:a.OPEN_ELEMENT,continue:!1,tag:c[2],selfClosing:a.isSelfClosing(c[2])||a.isSelfClosing(e),props:a.convertProps(c[3],!0)}:{chunk:d,type:a.OPEN_ELEMENT,continue:!0,tag:c[2],selfClosing:a.isSelfClosing(c[2]),props:a.convertProps(c[3])}}c&&c[1]!==d?this.setCurrent(d.substring(c[1].length)):this.setCurrent("")}return b}}]),a}(),aa=function(){function a(){x(this,a)}return y(a,[{key:"addChunk",value:function(a){for(var b=this,c=new _(a),d=c.next();d;){switch(d.type){case _.OPEN_ELEMENT:d.continue?(this.elementOpenStart(d),this.setElementOpen(d.tag)):this.elementOpen(d);break;case _.OPEN_ELEMENT_END:this.elementOpenEnd(d),this.clearElementOpen();break;case _.CLOSE_ELEMENT:this.elementClose(d);break;case _.CONTENT:if(this.isElementOpen()){var e=_.convertProps(d.content);e&&r(e,function(a,c){c===!1?b.hasLastAttr()?b.fillLastAttr(a):b.setLastAttr(a):b.addProperty(a,c)})}else this.addText(d)}d=c.next()}}},{key:"elementOpen",value:function(a){var c=this;a.props&&r(a.props,function(b,d){d===!1&&(c.setLastAttr(b),delete a.props[b])});var d=s(a.props);a.selfClosing?b.elementVoid.apply(b,[a.tag,null,null].concat(S(d))):b.elementOpen.apply(b,[a.tag,null,null].concat(S(d)))}},{key:"elementOpenStart",value:function(a){var c=this;a.props&&r(a.props,function(b,d){d===!1&&(c.setLastAttr(b),delete a.props[b])});var d=s(a.props);b.elementOpenStart.apply(b,[a.tag,null,null].concat(S(d)))}},{key:"elementOpenEnd",value:function(a){b.elementOpenEnd(),(a.selfClosing||_.isSelfClosing(this.getElementOpen()))&&this.elementClose(a)}},{key:"elementClose",value:function(a){b.elementClose(a.tag),this.clearLastAttr()}},{key:"addText",value:function(a){b.text(a.content)}},{key:"addProperty",value:function(a,c){b.attr(a,c)}},{key:"fillLastAttr",value:function(a){this.addProperty(this.getLastAttr(),a),this.clearLastAttr()}},{key:"setLastAttr",value:function(a){this.hasLastAttr()&&this.fillLastProperty(this.getLastAttr(),!0),this.lastAttr=a}},{key:"clearLastAttr",value:function(){this.lastAttr=null}},{key:"getLastAttr",value:function(){return this.lastAttr}},{key:"hasLastAttr",value:function(){return!!this.lastAttr}},{key:"setElementOpen",value:function(a){this.lastElement=a}},{key:"getElementOpen",value:function(){return this.lastElement}},{key:"isElementOpen",value:function(){return!!this.lastElement}},{key:"clearElementOpen",value:function(){this.lastElement=null}}]),a}(),ba=function(){function a(b){x(this,a),this.reset(),this.renderFunction=b}return y(a,[{key:"render",value:function(a){for(var c=this,d=arguments.length,e=Array(d>1?d-1:0),f=1;f<d;f++)e[f-1]=arguments[f];return b.patchInner(a,function(){return c.renderFunction.apply(c,[c.t.bind(c)].concat(e))})}},{key:"reset",value:function(){this.renderFactory=new aa}},{key:"t",value:function(a){for(var b=this,c=arguments.length,d=Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];Array.isArray(a)||(a=[a]),a.forEach(function(a,c){b.renderFactory.addChunk(a),c<d.length&&(b.renderFactory.hasLastAttr()?b.renderFactory.fillLastAttr(d[c]):b.t(t(d[c])))})}}]),a}(),ca=function(a){return function(a){function b(){x(this,b);var a=B(this,Object.getPrototypeOf(b).call(this));return a.template&&(a.observeProperties(function(){a.render()}),a.render()),a}return C(b,a),y(b,[{key:"render",value:function(){var a=this.template;if(!(a instanceof ba))throw new Error("Invalid template property.");a.render(this)}}]),b}(a)},da=function(a){function b(){return x(this,b),B(this,Object.getPrototypeOf(b).apply(this,arguments))}return C(b,a),b}(z(G).with(ca)),ea=z(G).with(M,Q,O,ca),fa=function(a){function b(){return x(this,b),B(this,Object.getPrototypeOf(b).apply(this,arguments))}return C(b,a),b}(ea),ga=self.customElements,ha=!f(ga),ia=b.notifications.nodesCreated,ja=b.notifications.nodesDeleted,ka=b.attributes[b.symbols.default];b.notifications.nodesCreated=function(a){a.forEach(function(a){return v(a)}),ia&&ia(a)},b.notifications.nodesDeleted=function(a){a.forEach(function(a){if(a.nodeType===Node.ELEMENT_NODE){var b=u(a);b&&a.disconnectedCallback()}}),ja&&ja(a)},b.attributes[b.symbols.default]=function(a,b,c){var d=u(a);if(d){a.is||v(a,d);var e=a.getAttribute(b);d.Ctr.observedAttributes&&d.Ctr.observedAttributes.indexOf(b)!==-1&&a.attributeChangedCallback(b,e,c)}ka&&ka(a,b,c)};var la='2.0.0-beta3'||"dev";a.Version=la,a.mix=z,a.BaseComponent=fa,a.Template=ba,a.polyfill=i,a.define=w,a.prop=m,a.Component=G,a.PropertiesMixin=M,a.PropertiesComponent=N,a.EventsMixin=O,a.EventsComponent=P,a.StyleMixin=Q,a.StyleComponent=R,a.TemplateMixin=ca,a.TemplateComponent=da,Object.defineProperty(a,"__esModule",{value:!0})});